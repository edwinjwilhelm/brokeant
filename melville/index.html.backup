<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BrokeAnt Market - Melville</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      height: 100vh;
      overflow: hidden;
    }
    
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #133d60, #184c75);
      color: white;
      padding: 20px;
      text-align: center;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    header h1 {
      font-size: 28px;
      margin: 0;
    }
    
    .container {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 10px;
      padding: 10px;
      margin-top: 70px;
      height: calc(100vh - 80px);
    }
    
    .left-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      overflow-y: auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .right-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      overflow-y: auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      align-content: start;
    }
    
    .form-section h2 {
      color: #133d60;
      font-size: 18px;
      margin-bottom: 15px;
      border-bottom: 2px solid #ffb34d;
      padding-bottom: 10px;
    }
    
    .form-group {
      margin-bottom: 12px;
    }
    
    .form-group label {
      display: block;
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
      font-size: 13px;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: Arial, sans-serif;
      font-size: 13px;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 60px;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #ffb34d;
      box-shadow: 0 0 5px rgba(255, 179, 77, 0.3);
    }
    
    .btn-submit {
      width: 100%;
      padding: 10px;
      background: #ffb34d;
      color: #402600;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
    }
    
    .btn-submit:hover {
      background: #ff9d1f;
    }
    
    .item-block {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .item-block img {
      width: 100%;
      height: 120px;
      object-fit: cover;
    }
    
    .item-block .no-image {
      width: 100%;
      height: 120px;
      background: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 12px;
    }
    
    .item-block .content {
      padding: 10px;
    }
    
    .item-block h3 {
      color: #133d60;
      font-size: 13px;
      margin-bottom: 4px;
    }
    
    .item-block p {
      color: #666;
      font-size: 11px;
      margin-bottom: 4px;
    }
    
    .item-price {
      color: #ffb34d;
      font-weight: bold;
      font-size: 12px;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .close-modal {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close-modal:hover {
      color: black;
    }
    
    .modal img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .modal h1 {
      color: #133d60;
      margin-top: 0;
    }
    
    .modal .price {
      color: #ffb34d;
      font-size: 24px;
      font-weight: bold;
      margin: 15px 0;
    }
    
    .modal .contact {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
    }
    
    .modal a {
      color: #133d60;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

<header>
  <h1>BrokeAnt Marketplace</h1>
  <p style="font-size: 12px; margin-top: 5px;">Melville - Buy, Sell & Trade</p>
</header>

<div class="container">
  <div class="left-panel">
    <div class="form-section">
      <h2>üìù Post Your Item</h2>
      
      <form id="itemForm">
        <div class="form-group">
          <label>Item Type:</label>
          <select id="itemType" required>
            <option value="">-- Select --</option>
            <option value="For Sale">For Sale</option>
            <option value="Want Ad">Want Ad</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Item Name:</label>
          <input type="text" id="itemName" placeholder="e.g., Mountain Bike" required>
        </div>
        
        <div class="form-group">
          <label>Description:</label>
          <textarea id="itemDesc" placeholder="Describe your item..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Price (optional):</label>
          <input type="text" id="itemPrice" placeholder="e.g., $50">
        </div>
        
        <div class="form-group">
          <label>Image URL:</label>
          <input type="text" id="itemImage" placeholder="https://example.com/image.jpg">
        </div>
        
        <div class="form-group">
          <label>Email:</label>
          <input type="email" id="itemEmail" placeholder="your@email.com" required>
        </div>
        
        <button type="button" class="btn-submit" onclick="postItem()">Post Item</button>
      </form>
    </div>
  </div>

  <div class="right-panel" id="itemsContainer">
    <!-- Items will be displayed here, filtered by city -->
  </div>
</div>

<!-- Detail Modal -->
<div id="detailModal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <div id="modalBody"></div>
  </div>
</div>

<script>
  // Current city for this marketplace
  const CURRENT_CITY = 'melville';
  
  // Get all items from localStorage (shared database)
  function getAllItems() {
    const items = localStorage.getItem('brokeant_all_items');
    return items ? JSON.parse(items) : [];
  }
  
  // Get items for current city only
  function getCityItems() {
    const allItems = getAllItems();
    return allItems.filter(item => item.city === CURRENT_CITY);
  }
  
  // Save items to localStorage
  function saveItems(items) {
    localStorage.setItem('brokeant_all_items', JSON.stringify(items));
  }
  
  // Filter out phone numbers
  function removePhoneNumbers(text) {
    if (!text) return text;
    return text.replace(/(\+?1?\s?)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}/g, '');
  }
  
  // Replace foul language
  function filterLanguage(text) {
    if (!text) return text;
    const badWords = ['damn', 'hell', 'crap', 'ass', 'shit', 'bitch', 'fuck', 'dick', 'cunt', 'piss'];
    let filtered = text;
    badWords.forEach(word => {
      const regex = new RegExp('\\b' + word + '\\b', 'gi');
      filtered = filtered.replace(regex, '*'.repeat(word.length));
    });
    return filtered;
  }
  
  function openModal(itemType, itemName, itemDesc, itemPrice, itemImage, itemEmail) {
    const modalBody = document.getElementById('modalBody');
    let imageHTML = '';
    if (itemImage) {
      imageHTML = `<img src="${itemImage}" alt="${itemName}" onerror="this.style.display='none';">`;
    }
    
    modalBody.innerHTML = `
      ${imageHTML}
      <h1>${itemType}: ${itemName}</h1>
      <p>${itemDesc || 'No description'}</p>
      ${itemPrice ? `<div class="price">${itemPrice}</div>` : ''}
      <div class="contact">
        <strong>Contact Seller:</strong><br>
        <a href="mailto:${itemEmail}">${itemEmail}</a>
      </div>
    `;
    
    document.getElementById('detailModal').style.display = 'block';
  }
  
  function closeModal() {
    document.getElementById('detailModal').style.display = 'none';
  }
  
  window.onclick = function(event) {
    const modal = document.getElementById('detailModal');
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  }
  
  function postItem() {
    const itemType = document.getElementById('itemType').value;
    const itemName = document.getElementById('itemName').value;
    let itemDesc = document.getElementById('itemDesc').value;
    const itemPrice = document.getElementById('itemPrice').value;
    const itemImage = document.getElementById('itemImage').value;
    const itemEmail = document.getElementById('itemEmail').value;
    
    if (!itemType || !itemName) {
      alert('Please fill in Item Type and Item Name');
      return;
    }
    
    if (!itemEmail) {
      alert('Please provide an email address');
      return;
    }
    
    // Remove phone numbers from description
    itemDesc = removePhoneNumbers(itemDesc);
    
    // Filter foul language
    itemDesc = filterLanguage(itemDesc);
    
    // Create item object with city
    const newItem = {
      id: Date.now(),
      city: CURRENT_CITY,
      itemType: itemType,
      itemName: itemName,
      itemDesc: itemDesc,
      itemPrice: itemPrice,
      itemImage: itemImage,
      itemEmail: itemEmail,
      posted: new Date().toISOString()
    };
    
    // Save to shared database
    const allItems = getAllItems();
    allItems.push(newItem);
    saveItems(allItems);
    
    // Display item on this page
    displayItem(newItem);
    
    // Clear form
    document.getElementById('itemForm').reset();
    alert('Item posted successfully!');
  }
  
  function displayItem(item) {
    const itemBlock = document.createElement('div');
    itemBlock.className = 'item-block';
    itemBlock.style.cursor = 'pointer';
    
    let imageHTML = '';
    if (item.itemImage) {
      imageHTML = `<img src="${item.itemImage}" alt="${item.itemName}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                   <div class="no-image" style="display:none;">Image not found</div>`;
    } else {
      imageHTML = '<div class="no-image">No Image</div>';
    }
    
    itemBlock.innerHTML = `
      ${imageHTML}
      <div class="content">
        <h3>${item.itemType}: ${item.itemName}</h3>
        <p>${item.itemDesc || 'No description'}</p>
        ${item.itemPrice ? `<div class="item-price">${item.itemPrice}</div>` : ''}
      </div>
    `;
    
    // Add click event to open detail modal
    itemBlock.addEventListener('click', function() {
      openModal(item.itemType, item.itemName, item.itemDesc, item.itemPrice, item.itemImage, item.itemEmail);
    });
    
    document.getElementById('itemsContainer').appendChild(itemBlock);
  }
  
  // Load items for this city when page loads
  function loadCityItems() {
    const container = document.getElementById('itemsContainer');
    container.innerHTML = ''; // Clear container
    
    const cityItems = getCityItems();
    if (cityItems.length === 0) {
      container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">No items listed yet. Be the first to post!</p>';
    } else {
      cityItems.forEach(item => {
        displayItem(item);
      });
    }
  }
  
  // Load items on page load
  window.addEventListener('load', loadCityItems);
</script>

</body>
</html>
